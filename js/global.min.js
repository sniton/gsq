function siteInit(){siteIsInit||(getDimensions(),ajustStructure(),globalEvents(),navEvents(),contentEvents(),siteIsInit=!0)}function siteResfresh(){siteIsInit&&(getDimensions(),ajustSections())}function globalEvents(){$(document).bind("touchmove",!1),oSound=new sound,oPanier=new panier,oContact=new contact,$("#pages .panier .actions .clearall").hammer().on("tap",function(){oPanier.emptyPanier()}),$("#form_paniersend").submit(function(a){a.preventDefault();var b=$(".input_email",this).val();b&&oPanier.send(b)})}function getDimensions(){newwindowWidth=window.innerWidth>$(window).width()?window.innerWidth:$(window).width(),newwindowHeight=window.innerHeight>$(window).height()?window.innerHeight:$(window).height(),(windowWidth!=newwindowWidth||windowHeight!=newwindowHeight)&&(windowWidth=newwindowWidth,windowHeight=newwindowHeight)}function ajustStructure(){windowHeight=windowHeight>748?748:windowHeight,$("#wrapper").height(windowHeight)}function onLoadPanier(){console.log("--onLoadPanier"),oPanier.refresh()}function onLoadPanierSend(){if(navigator.connection){var a=navigator.connection.type;a==Connection.NONE?$("#pages .paniersend .etatconnexion").addClass("offline"):$("#pages .paniersend .etatconnexion").removeClass("offline")}}function navEvents(){oNavigation=new navigation}function contentEvents(){oDatas=new datas}function onLoadCapabilities(){$("#pages .capabilities .marker").hammer().off("tap").on("tap",function(){var a=$(this).attr("data-page");oNavigation.navTo(a,"capabilities","< Back to Capabilities")})}function onLoadGdfsuez(){oGdfsuezSlider||(oGdfsuezSlider=new gdfsuezSlider),oGdfsuezSlider.next()}function onUnloadGdfsuez(){oGdfsuezSlider.hide()}function onLoadGulfPresence(){$("#pages .gulf-presence .marker, .template.gulf-presence .zoomqatar").hammer().off("tap").on("tap",function(){var a=$(this).attr("data-pays");oNavigation.navTo("pays-"+a)})}function onLoadPays(){console.log("--onLoadPays"),$("#pages .pays .reference").hammer().off("tap").on("tap",function(){var a=$(this).attr("data-page");oNavigation.navTo(a,oNavigation.currentPage,"< Back to State")})}function onLoadInfographics(){console.log("--onLoadInfographics"),$("#pages .infographics .marker").hammer().off("tap").on("tap",function(){var a=$(this).attr("data-page");oNavigation.navTo(a,oNavigation.currentPage,"< Back to Infographics")})}function onLoadCityofTomorrow(){$("#pages .city-of-tomorrow .marker").hammer().off("tap").on("tap",function(){var a=$(this).attr("data-popin"),b=$("#pages .city-of-tomorrow .popin"+a),c=b.height(),d=-c/2-60;b.css("margin-top",d).addClass("active").siblings().removeClass("active")}),$("#pages .city-of-tomorrow .popin").hammer().off("tap").on("tap",function(){$(this).removeClass("active")})}function onLoadActivities(){$("#pages .activities .marker").hammer().off("tap").on("tap",function(){var a=$(this).attr("data-page");oNavigation.navTo(a)})}function onLoadTechnologies(){console.log("--onLoadTechnologies"),$("#pages .technologies1 .marker, #pages .technologies2 .marker, #pages .technologies3 .marker, #pages .technologies4 .marker").hammer().off("tap").on("tap",function(){var a=$(this).attr("data-page");oNavigation.navTo(a,oNavigation.currentPage,"< Back to Technologies")})}function onLoadReference(){$("#pages .reference .photos .photo").hammer().off("tap").on("tap",function(){$(this).toggleClass("active")})}function onLoadVideo(){console.log("--onLoadVideo"),$("#pages .video video").hammer().off("tap").on("tap",function(){$(this).get(0).paused?($(this).get(0).play(),$(this).next(".play").removeClass("active")):($(this).get(0).pause(),$(this).next(".play").addClass("active"))})}function onUnloadVideo(){console.log("--onUnloadVideo"),$("#pages .video video").get(0).pause(),$("#pages .video .play").addClass("active")}var windowWidth,windowHeight,siteIsInit=!1;$(window).load(function(){siteInit()});var oSound,oPanier,oContact,sound=function(){var b=Array();this.construct=function(){$.ajax({dataType:"json",url:"configs/sounds.json",success:function(a){$.each(a,function(a,c){b[a]=new Audio("sounds/"+c),b[a].play()})}})},this.play=function(a){b[a].play()},this.construct()},panier=function(){var a=this;this.construct=function(){this.opened=!1,this.panier=$("#panier"),this.panierList={reference:{},video:{},capability:{},technologie:{},plaquette:{}},this.availableItemsByType={reference:{},video:{},capability:{},technologie:{},plaquette:{}},$.ajax({dataType:"json",url:"configs/panier.json",success:function(b){a.availableItems=b,$.each(a.availableItems,function(b,c){a.availableItemsByType[c.type][b]=c});var c="";c+="<dt>Your contacts</dt>",c+='<dd class="item disabled checked" data-item="allcontacts">Your GDF SUEZ contact for all your projects</dd>',c+="<dt>Videos</dt>",$.each(a.availableItemsByType.video,function(a,b){c+='<dd class="item">'+b.title+"</dd>"}),c+="<dt>Technologies</dt>",$.each(a.availableItemsByType.technologie,function(a,b){c+='<dd class="item" data-item="'+a+'">'+b.title+"</dd>"}),c+="<dt>Capabilities</dt>",$.each(a.availableItemsByType.capability,function(a,b){c+='<dd class="item" data-item="'+a+'">'+b.title+"</dd>"}),c+="<dt>Plaquettes</dt>",$.each(a.availableItemsByType.plaquette,function(a,b){c+='<dd class="item" data-item="'+a+'">'+b.title+"</dd>"}),c+="<dt>Videos</dt>",$.each(a.availableItemsByType.video,function(a,b){c+='<dd class="item" data-item="'+a+'">'+b.title+"</dd>"}),c+="<dt>References</dt>",$.each(a.availableItemsByType.reference,function(a,b){c+='<dd class="item" data-item="'+a+'">'+b.title+"</dd>"}),$("#pages .panier .content .liste").html(c),$("#pages .panier .content .liste .item:not(.disabled)").hammer().on("tap",function(){console.log("check panier item");var a=$(this).attr("data-item");$(this).toggleClass("checked"),$(this).hasClass("checked")?(oPanier.addToPanier(a),oSound.play("paniercheck")):(oPanier.removeToPanier(a),oSound.play("panieruncheck"))}),$("#pages .panier .content .wrapper").tinyscrollbar({invertscroll:!0})}}),$(this.panier).hammer().on("tap",function(){a.open()}),$(".button",this.panier).hammer().on("tap",function(){a.close()}),$(".menu .item",this.panier).hammer().on("tap",function(){a.lauchAction(this)}),a.restorePanierList()},this.open=function(){this.opened||(oSound.play("panieropen"),this.panier.addClass("active"),setTimeout(function(){a.opened=!0},500),$("#contact").addClass("hide"))},this.close=function(){this.opened&&(oSound.play("panieropen"),this.panier.removeClass("active"),$(".menu .item",this.panier).removeClass("active"),setTimeout(function(){a.opened=!1},500),("panier"==oNavigation.currentPage||"paniersend"==oNavigation.currentPage)&&oNavigation.navTo("home"),$("#contact").removeClass("hide"))},this.lauchAction=function(a){oSound.play("panieradd"),$(".menu .item.active",this.panier).removeClass("active"),$(a).addClass("active");var b=$(a).attr("data-action");switch(b){case"add":this.addToPanier();break;case"see":this.seePanier();break;case"send":this.sendPanier();break;case"empty":this.emptyPanier()}},this.setAvailable=function(a){a?(this.panier.addClass("available"),this.availableItem=a,this.isInPanier(a)):(this.panier.removeClass("available"),this.availableItem=null)},this.addToPanier=function(a){var a=a?a:this.availableItem,b=this.availableItems[a],c=b.type;this.panierList[c][a]=b,console.log(this.panierList),this.refresh()},this.removeToPanier=function(a){var a=a?a:this.availableItem,b=this.availableItems[a],c=b.type;delete this.panierList[c][a],console.log(this.panierList),this.refresh()},this.seePanier=function(){a.restorePanierList(),oNavigation.navTo("panier")},this.sendPanier=function(){oNavigation.navTo("paniersend")},this.emptyPanier=function(){confirm("Voulez-vous vider le panier ?")&&(this.panierList={reference:{},video:{},capability:{},technologie:{},plaquette:{}},console.log(this.panierList),this.refresh())},this.send=function(b){if(console.log("--send"),navigator.connection){var c=navigator.connection.type;if(c==Connection.NONE)confirm("Vous n'\u00eates pas connect\u00e9 \u00e0 internet. Voulez-vous sauvegarder votre panier pour l'envoyer ult\u00e9rieurement ?")&&a.savePanierList();else{var d={destinataire:b,items:[]};$.each(this.panierList,function(a,b){$.each(b,function(a){d.items.push(a)})}),console.log(d);var e=JSON.stringify(d);console.log(e),$.ajax({url:"http://test.kromi.fr/gdfqatarserveur/index.php",contentType:"application/json",dataType:"jsonp",jsonpCallback:e}),alert("L'e-mail a \u00e9t\u00e9 envoy\u00e9 avec succ\u00e8s")}}},this.savePanierList=function(){localStorage.setItem("panierList",JSON.stringify(a.panierList)),alert("Panier sauvegard\u00e9")},this.restorePanierList=function(){var b=localStorage.getItem("panierList");b&&(a.panierList=JSON.parse(b),localStorage.removeItem("panierList"))},this.refresh=function(){var a=Object.keys(this.panierList.technologie).length;$("#pages .panier .facettes .technologies, #pages .paniersend .facettes .technologies").text(a);var b=Object.keys(this.panierList.capability).length;$("#pages .panier .facettes .capabilities, #pages .paniersend .facettes .capabilities").text(b);var c=Object.keys(this.panierList.plaquette).length;$("#pages .panier .facettes .plaquettes, #pages .paniersend .facettes .plaquettes").text(c);var d=Object.keys(this.panierList.video).length;$("#pages .panier .facettes .videos, #pages .paniersend .facettes .videos").text(d);var e=Object.keys(this.panierList.reference).length;$("#pages .panier .facettes .references, #pages .paniersend .facettes .references").text(e),this.totalPanierItems=a+b+c+d+e+1;var f=10>this.totalPanierItems?"0"+this.totalPanierItems:this.totalPanierItems;$("#pages .panier .counter, #pages .paniersend .counter").text(f),$("#pages .panier input").attr("checked",!1),$.each(this.panierList,function(a,b){$.each(b,function(a){console.log("check "+a),$("#pages .panier #panierItem"+a).attr("checked",!0)})}),this.totalPanierItems?$(".menu .item.vider",this.panier).removeClass("disabled"):$(".menu .item.vider",this.panier).addClass("disabled"),this.isInPanier(this.availableItem)},this.isInPanier=function(a){if(a){var b=this.availableItems[a].type;this.panierList[b][a]?($(".menu .item.ajouter",this.panier).hide(),$(".menu .item.retirer",this.panier).show()):($(".menu .item.ajouter",this.panier).show(),$(".menu .item.retirer",this.panier).hide())}else $(".menu .item.ajouter",this.panier).show(),$(".menu .item.retirer",this.panier).hide()},this.construct()},contact=function(){var a=this;this.construct=function(){this.opened=!1,this.contact=$("#contact"),$.ajax({dataType:"json",url:"configs/contacts.json",success:function(b){a.contactDatas=b}}),$(this.contact).hammer().on("tap",function(){a.open()}),$(".button",this.contact).hammer().on("tap",function(){a.close()})},this.open=function(){if(!this.opened){this.contact.addClass("active"),oNavigation.navTo("contacts");var b="",c=1;$.each(a.contactDatas,function(a,d){console.log(d);var e=a.replace("contact-",""),f=d.adresse?"<br>"+d.adresse:"";b+='<div class="bloc bloc'+c+'"><div class="header"><img src="uploads/societes/'+e+'.jpg">'+f+'<div class="clear"></div></div><ul>',$.each(d.capabilities,function(a,c){b+="<li>- "+c.titre+"</li>"}),b+="</ul></div>",c++}),$("#pages .contacts .colright .overview").append(b),$("#pages .contacts .content .colright").tinyscrollbar({invertscroll:!0}),setTimeout(function(){a.opened=!0},500)}},this.close=function(){this.opened&&(this.contact.removeClass("active"),oNavigation.navTo("home"),setTimeout(function(){a.opened=!1},500))},this.construct()},inNavAction=!1,oNavigation,navigation=function(){var a=this,e=$("#menu");Array();var g=!1;this.construct=function(){this.currentPage="home",this.currentMenus=[null,null]},this.loadArborescence=function(){$.ajax({dataType:"json",url:"configs/arborescence.json",success:function(b){a.arborescence=b,console.log(b)}})},this.defaultEvents=function(){$(".niveau0 .linkZone",e).hammer().on("tap",function(){if(!inNavAction){inNavAction=!0;var b=$(this).attr("data-page");a.navTo(b),setTimeout(function(){inNavAction=!1},500)}}),$(e).hammer().on("swipe",function(b){console.log("swipe on menu");var c=b.gesture.direction;"down"==c?a.hideMenu():"up"==c&&a.showMenu()}),$("header#header .backLink").hammer().on("tap",function(){var b=$(this).attr("data-page");$(this).attr("data-page","").removeClass("active"),a.navTo(b)}),$("header#header .menuLink").hammer().on("tap",function(){a.showMenu()}),$("#logo").hammer().on("tap",function(){a.navTo("video-test")})},this.niveau1and2Events=function(){$(".niveau1 .linkZone, .niveau2 .linkZone",e).hammer().off("tap swipe").on("tap",function(){inNavAction=!0;var b=$(this).attr("data-page");a.navTo(b),setTimeout(function(){inNavAction=!1},300)}).on("swipe",function(b){if(g){console.log("swipe on nav"),console.log(g),console.log(this);var c=b.gesture.direction,d=$(this).attr("data-index");if("left"==c?d++:"right"==c&&d--,"left"==c||"right"==c){console.log($(this).parent().find(".linkZone[data-index="+d+"]"));var e=$(this).parent().find(".linkZone[data-index="+d+"]").attr("data-page");a.navTo(e)}}})},this.navTo=function(a,b,c){console.log("--navTo"),console.log(a),console.log(this.arborescence[a]);var d=this.arborescence[a].redirect;d?this.navTo(d):(b&&$("header#header .backLink").attr("data-page",b).text(c).addClass("active"),this.changeFond(this.arborescence[a].fond),this.changePage(a),oPanier.setAvailable(this.arborescence[a].panier))},this.changeFond=function(a){console.log("--changeFond"),console.log(a+" "+this.currentFond),a&&a!=this.currentFond&&($("#fonds .fond.active").removeClass("active"),$("#fonds .fond."+a).addClass("active"),this.currentFond=a)},this.changePage=function(b){if(console.log("--changePage"),b!=this.currentPage){var c=this.arborescence[b].virtual,d=a.arborescence[this.currentPage].onunload;if(d&&window[d](),!c){$("#pages .template.active").removeClass("active").addClass("last");var f=this.arborescence[b].template;if(f){if(!$("#pages .template[data-page="+b+"]").length){console.log("la page n'existe pas, il faut la charger");var g=a.arborescence[b].datas;if(g)oDatas.pushDatasToTemplate(g,f);else{var h=$("#templates .template."+f).html();$('<div class="template '+f+'" data-page="'+b+'"></div>').html(h).appendTo("#pages")}}setTimeout(function(){$("#pages .template.last").remove(),console.log("add class active to page"),console.log($("#pages .template[data-page="+b+"]")),$("#pages .template[data-page="+b+"]").addClass("active");var c=a.arborescence[b].onload;c&&window[c]()},700)}else console.log("error: le template n'existe pas")}this.arborescence[b].disablemenu?($(e).addClass("disabled").removeClass("isniveau1 isniveau2"),$("header#header .menuLink").removeClass("active")):($(e).removeClass("disabled"),this.refreshMenu(b,c)),this.currentPage=b}},this.refreshMenu=function(b,c){console.log("--refreshMenu");var d=this.arborescence[b].niveau,f=this.arborescence[b].angle,g=this.arborescence[b].reversemenu;console.log(d),console.log(f),console.log(g),2==d?($(e).addClass("isniveau1 isniveau2"),this.loadMenu(this.arborescence[b].parent),setTimeout(function(){$(".niveau2",e).css("-webkit-transform","scale(1) rotate("+f+"deg)")},100)):1==d?($(".niveau2",e).css("-webkit-transform","scale(0) rotate(0deg)"),$(e).addClass("isniveau1").removeClass("isniveau2"),$(".niveau1",e).css("-webkit-transform","scale(1) rotate("+f+"deg)")):0==d?($(".niveau2, .niveau1",e).css("-webkit-transform","scale(0) rotate(0deg)"),$(e).removeClass("isniveau1 isniveau2")):($(".niveau2, .niveau1",e).css("-webkit-transform","scale(0) rotate(0deg)"),$(e).removeClass("isniveau1 isniveau2 hide"),$("header#header .menuLink").removeClass("active")),g?$(e).addClass("reversed"):$(e).removeClass("reversed"),c?this.loadMenu(b):"home"!=b&&setTimeout(function(){a.hideMenu()},300)},this.loadMenu=function(b){console.log("--loadMenu");var c=this.arborescence[b].menu,d=this.arborescence[b].niveau+1;console.log(c+" "+d),a.currentMenus[d-1]!=c?$.ajax({url:"configs/menus/"+c+".html",success:function(b){setTimeout(function(){var f=$(b).find("g.niveau"+d);$(".niveau"+d,e).replaceWith(f),a.niveau1and2Events(),$(e).addClass("isniveau"+d),$(".niveau"+d,e).css("-webkit-transform","scale(0) rotate(0deg)"),setTimeout(function(){$(".niveau"+d,e).css("-webkit-transform","scale(1) rotate(0deg)")},10),a.currentMenus[d-1]=c,console.log(a.currentMenus)},10)}}):($(e).addClass("isniveau"+d),$(".niveau"+d,e).css("-webkit-transform","scale(1) rotate(0deg)"))},this.showMenu=function(){$(e).removeClass("hide"),g=!1,oSound.play("panieropen"),$("header#header .menuLink").removeClass("active")},this.hideMenu=function(){($(e).hasClass("isniveau1")||$(e).hasClass("isniveau2"))&&($(e).addClass("hide"),g=!0,oSound.play("panieropen"),$("header#header .menuLink").addClass("active"))},this.construct(),this.loadArborescence(),this.defaultEvents(),this.niveau1and2Events()},oDatas,datas=function(){var a=this;this.loadDatas=function(){console.log("--loadDatas"),$.ajax({dataType:"json",url:"configs/data.json",success:function(b){console.log("success load datas"),console.log(b),a.loadedDatas=b}})},this.pushDatasToTemplate=function(a,b){console.log("--pushDatasToTemplate"),console.log(a),console.log(this.loadedDatas),console.log(this.loadedDatas[a]);var c=$("#templates .template."+b).html(),d=Mustache.render(c,this.loadedDatas[a]),a=$('<div class="template '+b+'" data-page="'+a+'"></div>').html(d).appendTo("#pages")},this.loadDatas()},oGdfsuezSlider=null,gdfsuezSlider=function(){var b,c,d,a=this;this.app=function(){b=$("#pages .gdfsuez"),c=0,d=$(".slide",b).length,$(b).hammer().off("swipeleft swiperight").on("swipeleft",function(){console.log("next"),a.next()}).on("swiperight",function(){console.log("prev"),a.prev()}),$(".slide3 .marker",b).hammer().on("tap",function(){$(this).toggleClass("active").siblings().removeClass("active")})},this.next=function(){d>c&&($(".slide.slide"+c,b).addClass("prev"),c++,$(".slide.slide"+c,b).removeClass("next"),a.pagination())},this.prev=function(){c>1&&($(".slide.slide"+c,b).addClass("next"),c--,$(".slide.slide"+c,b).removeClass("prev"),a.pagination())},this.pagination=function(){var a=10>c?"0"+c:c;$(".pagination",b).html("<span>"+a+"/</span>"+d)},this.hide=function(){$(".slide",b).removeClass("prev").addClass("next"),c=0},this.app()};